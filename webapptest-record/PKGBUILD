developer="http://indiecomputing.com/"
url="http://ubos.net/"
maintainer=$developer
pkgname=$(basename $(pwd))
pkgver=0.1
pkgrel=1
pkgdesc="Records web app interactions and generates webapptest tests"
arch=('any')
license=('AGPL3')
makedepends=(
    'maven'
    'jdk8-openjdk')
depends=(
    'java-runtime')
options=('!strip')

prepare() {
    # Set pom.xml versions correctly; depends on XML-comment-based markup in pom.xml files
    find ${startdir} -name pkg -and -type d -prune -or -name pom.xml -exec perl -pi -e "s/(?<=\<\!-- PKGVER -->)(\d+(\.\d+)+)(?=\<\!-- \/PKGVER -->)/${pkgver}/g" {} \;
}

build() {
    cd ${startdir}/net.ubos.webapptest.record
    mvn package install ${MVN_OPTS}
}

package() {
    installJar 'net.ubos.webapptest.record'
}

installJar() {
    local name=$1
    install -m644 -D ${startdir}/${name}/target/${name}-${pkgver}.jar ${pkgdir}/usr/lib/java/ubos/net/webapptest/record/${name}/${pkgver}/${name}-${pkgver}.jar
}
