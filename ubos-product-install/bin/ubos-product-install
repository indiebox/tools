#!/usr/bin/perl
#
# Install a product, if a product definition can be found. If successful installing,
# shut down. If unsuccessful, or no product definition was found, stay up.
#
# Copyright (C) 2014 and later, Indie Computing Corp. All rights reserved. License: see package.
#

use strict;
use warnings;

use UBOS::Host;
use UBOS::Logging;

UBOS::Logging::initialize( 'ubos-product-install', undef, 0, '/etc/ubos/log-system.conf' );

my $productJson = '/etc/ubos-product-install/product.json';
my $shutdown    = 0;

if( -e $productJson ) {
    my $status = UBOS::Utils::myexec( 'ubos-install --product ' . $productJson );
    if( $status == 0 ) {
        $shutdown = 1;
    }
}

if( $shutdown ) {
    UBOS::Utils::myexec( "systemctl poweroff" );
}

1;
